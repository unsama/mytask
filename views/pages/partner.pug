doctype html
html(lang='en')
    head
        meta(charset='UTF-8')
        meta(name='viewport', content='width=device-width, initial-scale=1, maximum-scale=1')

        //facebook sharing content
        meta(property="fb:app_id" content="1379317195528816")
        meta(property="og:url" content="https://roadioapp.com/partner")
        meta(property="og:type" content="profile")
        meta(property="og:title" content="RoadioApp Partner")
        meta(property="og:description" content="RoadioApp gives an amazing opportunity to vehicle owners to earn a stable income every month and also bonuses on quarterly basis.")
        meta(property="og:image" content="https://roadioapp.com/images/fav_icon.png")

        title Roadioapp
        link(rel='icon', href='/images/fav_icon.png')

        link(rel='stylesheet', href='/stylesheets/bootstrap.min.css')
        link(rel='stylesheet', href='/stylesheets/assets/elegant-icons/style.css')
        link(rel='stylesheet', href='/stylesheets/assets/app-icons/styles.css')
        link(href='https://fonts.googleapis.com/css?family=Roboto:100,300,100italic,400,300italic', rel='stylesheet', type='text/css')
        link(rel='stylesheet', href='/stylesheets/css/owl.theme.css')
        link(rel='stylesheet', href='/stylesheets/css/owl.carousel.css')
        link(rel='stylesheet', href='/stylesheets/css/nivo-lightbox.css')
        link(rel='stylesheet', href='/stylesheets/css/nivo_themes/default/default.css')
        link(rel='stylesheet', href='/stylesheets/font-awesome.css')

        link(rel='stylesheet', href='/stylesheets/css/animate.min.css')

        link(rel='stylesheet', href='/stylesheets/css/styles.css')

        link(rel='stylesheet', href='/stylesheets/css/colors/blue.css')

        link(rel='stylesheet', href='/stylesheets/css/responsive.css')
        link(href='/stylesheets/css/style.css', rel='stylesheet', type='text/css')
        link(href='/stylesheets/css/indexform.css', rel='stylesheet', type='text/css')
        script(src='/javascripts/jquery.min.js')
    body
        .preloader
            .status
        header#home.header
            .color-overlay23
                .navbar.navbar-inverse.bs-docs-nav.navbar-fixed-top.sticky-navigation
                    .container
                        .navbar-header
                            button.navbar-toggle(type='button', data-toggle='collapse', data-target='#kane-navigation')
                                span.sr-only Toggle navigation
                                span.icon-bar
                                span.icon-bar
                                span.icon-bar
                            a.navbar-brand(href='/')
                                img(src='/images/roadio_logo_web.png', alt='')
                        #kane-navigation.navbar-collapse.collapse
                            ul.nav.navbar-nav.navbar-right.main-navigation
                                li
                                    a(href='/') Home
                                li
                                    a(href='/') Features
                                li
                                    a(href='/') Why Us?
                                li
                                    a(href='/') About
                                li
                                    a(href='/') Services
                                li
                                    a(href='/') How to order
                                li
                                    a(href='/') Download
                                li
                                    a(href='/privacy') Privacy
                                li
                                    a(href='/partner') Partner
                                li
                                    a(href='/faqs') FAQs
        .formBack
            form#msform(enctype="multipart/form-data" method="post" name="partner_form")
                ul#progressbar
                    li.active Roadioapp
                    li Social Profiles
                    li Rider Verification
                    li Success
                fieldsets
                    fieldset
                        h2 Roadioapp
                        h4 Form
                        p
                            | Roadioapp, together with partners
                            | registered in Pakistan, providing services city courier, trucking, transportation and
                            | warehousing.
                        .form-group
                            input.varcheck.form-control.verChk(type='text', name='fname', placeholder='First Name')
                            p.text-danger.text-right
                        .form-group
                            input.varcheck.form-control.verChk(type='text', name='lname', placeholder='Last Name')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='number', name='mobile_number', placeholder='Mobile Phone Number')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='number', name='cnic_number', placeholder='CNIC Number (without dashes "-")')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='text', name='driving_license', placeholder='Driving License')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='text', name='email', placeholder='Email')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='password', name='password', placeholder='Enter Password')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='password', name='confirm_password', placeholder='Confirm Password')
                            p.text-danger.text-right
                        input.next.action-button(type='button', name='next', value='Next')
                        i.fa.fa-refresh.fa-spin.fa-3x.fa-fw.loading_pros
                    fieldset
                        h2 Roadioapp
                        h4 Form
                        h4.text-left Transportation Type
                        p.text-danger.text-right.vehErr
                        .checkbox.text-left
                            label(for='vehicle1')
                                input#vehicle1.cusCheckBox(type='radio', name='vehicle', value='Bike' checked)
                                | Bike
                        .checkbox.text-left
                            label(for='vehicle2')
                                input#vehicle2.cusCheckBox(type='radio', name='vehicle', value='Car')
                                | Car
                        .checkbox.text-left
                            label(for='vehicle3')
                                input#vehicle3.cusCheckBox(type='radio', name='vehicle', value='Pickup')
                                | Pickup
                        .checkbox.text-left
                            label(for='vehicle4')
                                input#vehicle4.cusCheckBox(type='radio', name='vehicle', value='Truck')
                                | Truck
                        h4.text-left Vehicle Information
                        .form-group
                            input.form-control.verChk(type='number', name='model_year', placeholder='Model Year')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='text', name='vehicle_number', placeholder='Vehicle Number e.g(abc-123)')
                            p.text-danger.text-right
                        .form-group
                            input.form-control.verChk(type='text', name='make', placeholder='Make')
                            p.text-danger.text-right
                        input.previous.action-button(type='button', name='previous', value='Previous')
                        input.next.action-button(type='button', name='next', value='Next')
                        i.fa.fa-refresh.fa-spin.fa-3x.fa-fw.loading_pros
                    fieldset
                        h4.text-left Upload Following Scanned Documents
                        .checkbox.text-left
                            label
                                input#docsChg.cusCheckBox(type='checkbox')
                                | I don't have the documents right now
                        #docsCon
                            .form-group.form-inline
                                label(style='float: left; margin-right: 278px') Profile Image
                                input#fm_profile_img.docFile(type='file', value='button' name='fm_profile_img')
                                p.text-danger.text-left
                            .form-group.form-inline
                                label(style='float: left; margin-right: 211px') Scanned CNIC
                                input#fm_cnic_img.docFile(type='file', value='button' name='fm_cnic_img')
                                p.text-danger.text-left
                            .form-group.form-inline
                                label(style='float: left; margin-right: 191px') Scanned License
                                input#fm_license_img.docFile(type='file', value='button' name='fm_license_img')
                                p.text-danger.text-left
                            .form-group.form-inline
                                label(style='float: left; margin-right: 86px') Scanned Registration Letters
                                input#fm_reg_letter_img.docFile(type='file', value='button' name='fm_reg_letter_img')
                                p.text-danger.text-left
                        .checkbox.text-left
                            label
                                input.cusCheckBox(type='checkbox', name='vehicle_owner', value='Yes')
                                | Yes, I am the owner of this vehicle
                        div#errors_list
                        input.previous.action-button(type='button', name='previous', value='Previous')
                        input.next.action-button(type='button' name='submit', value='Submit')
                        i.fa.fa-refresh.fa-spin.fa-3x.fa-fw.loading_pros
                    fieldset
                        img(src='/images/tick2.png')
                        h2
                            | Successfully Submitted

        footer
            .container
                img.responsive-img.f_logo(src='/images/roadio_logo_web.png', alt='LOGO')
                ul.social-icons
                    li
                        a(href='https://www.facebook.com/RoadioApp-271823006566712/')
                            i.social_facebook_square
                p.copyright
                    | ©2017 Roadioapp, All Rights Reserved
        // Start of roadioapp Zendesk Widget script
        script.
            /*<![CDATA[*/window.zEmbed || function (e, t) {
                var n, o, d, i, s, a = [], r = document.createElement("iframe");
                window.zEmbed = function () {
                    a.push(arguments)
                }, window.zE = window.zE || window.zEmbed, r.src = "javascript:false", r.title = "", r.role = "presentation", (r.frameElement || r).style.cssText = "display: none", d = document.getElementsByTagName("script"), d = d[d.length - 1], d.parentNode.insertBefore(r, d), i = r.contentWindow, s = i.document;
                try {
                    o = s
                } catch (e) {
                    n = document.domain, r.src = 'javascript:var d=document.open();d.domain="' + n + '";void(0);', o = s
                }
                o.open()._l = function () {
                    var e = this.createElement("script");
                    n && (this.domain = n), e.id = "js-iframe-async", e.src = "https://assets.zendesk.com/embeddable_framework/main.js", this.t = +new Date, this.zendeskHost = "roadioapp.zendesk.com", this.zEQueue = a, this.body.appendChild(e)
                }, o.write('<body onload="document._l();">'), o.close()
            }();
            /*]]>*/
        // End of roadioapp Zendesk Widget script
        script(src='/javascripts/js/bootstrap.min.js')
        script(src='/javascripts/js/smoothscroll.js')
        script(src='/javascripts/js/jquery.scrollTo.min.js')
        script(src='/javascripts/js/jquery.localScroll.min.js')
        script(src='/javascripts/js/owl.carousel.min.js')
        script(src='/javascripts/js/nivo-lightbox.min.js')
        script(src='/javascripts/js/simple-expand.min.js')
        script(src='/javascripts/js/wow.min.js')
        script(src='/javascripts/js/jquery.stellar.min.js')
        script(src='/javascripts/js/retina.min.js')
        script(src='/javascripts/js/matchMedia.js')
        script(src='/javascripts/js/jquery.backgroundvideo.min.js')
        script(src='/javascripts/js/jquery.nav.js')
        script(src='/javascripts/js/jquery.ajaxchimp.min.js')
        script(src='/javascripts/js/jquery.fitvids.js')
        script(src='/javascripts/js/custom.js')
        script(src='/javascripts/easing.js', type='text/javascript')
        script(type='text/javascript').
            jQuery(document).ready(function ($) {
                $(".scroll").click(function (event) {
                    event.preventDefault();
                    $('html,body').animate({scrollTop: $(this.hash).offset().top}, 1000);
                });
            });
        script.
            $(function () {
                var pull = $('#pull');
                menu = $('nav ul');
                menuHeight = menu.height();
                $(pull).on('click', function (e) {
                    e.preventDefault();
                    menu.slideToggle();
                });
                $(window).resize(function () {
                    var w = $(window).width();
                    if (w > 320 && menu.is(':hidden')) {
                        menu.removeAttr('style');
                    }
                });
            });

        script.
            var filesDocs = {
                fm_profile_img: null,
                fm_cnic_img: null,
                fm_license_img: null,
                fm_reg_letter_img: null
            };
            var ajaxStatus = false;

            $(function(){
                $("#docsChg").change(function(){
                    var docsCon = $("#docsCon");
                    if(docsCon.css("display") === "none"){
                        docsCon.slideDown();
                    }else{
                        docsCon.slideUp();
                    }
                });

                $(".docFile").on("change", function(event){
                    var grabInput = $("#" + event.target.id);
                    var grabFile = grabInput[0].files[0];
                    var ValidImageTypes = ["image/jpeg", "image/png"];
                    if (typeof grabFile === "undefined") {
                        filesDocs[event.target.id] = null;
                    } else {
                        if (ValidImageTypes.indexOf(grabFile["type"]) < 0 || grabFile["size"] > 5000000) {
                            // invalid file
                            grabInput.replaceWith(grabInput.val("").clone(true));
                            filesDocs[event.target.id] = null;
                        } else {
                            filesDocs[event.target.id] = grabFile;
                        }
                    }
                });
            });
            function submitForm(fieldset){
                var grabAllFieldSet = fieldset.parent().find("fieldset");
                var findInd = grabAllFieldSet.index(fieldset);
                var lastFormErrDiv = $("#errors_list")
                var grabInputs = [];
                var csrf = "#{csrf}";
                lastFormErrDiv.html('');

                if(!ajaxStatus) {
                    if (findInd === 0) {
                        grabInputs = fieldset.find("input.verChk");
                        var sec1data = {_csrf: csrf};
                        for (var i = 0; i < grabInputs.length; i++) {
                            var selName = grabInputs[i].name;
                            var selVal = grabInputs[i].value;
                            sec1data[selName] = selVal;
                            fieldset.find("input[name=" + selName + "]").parent().find("p.text-danger").html("");
                        }

                        ajaxProsStart();
                        $.ajax({
                            url: "/sec_1_check",
                            type: "POST",
                            data: sec1data,
                            success: function (res) {
                                ajaxProsEnd();
                                csrf = res.csrf;
                                if (res.status === "failed") {
                                    res.errors.forEach(function (err) {
                                        var grabErrField = fieldset.find("input[name=" + err.param + "]").parent().find("p.text-danger");
                                        grabErrField.html(err.msg);
                                    });
                                } else {
                                    next();
                                }
                            }
                        });
                    } else if (findInd === 1) {
                        grabInputs = fieldset.find("input.verChk");
                        var sec2data = {_csrf: csrf};
                        for (var i = 0; i < grabInputs.length; i++) {
                            var selName = grabInputs[i].name;
                            var selVal = grabInputs[i].value;
                            sec2data[selName] = selVal;
                            fieldset.find("input[name=" + selName + "]").parent().find("p.text-danger").html("");
                        }
                        sec2data['vehicle'] = fieldset.find("input[name=vehicle]:checked").val();
                        fieldset.find("p.text-danger.vehErr").html("");

                        ajaxProsStart();
                        $.ajax({
                            url: "/sec_2_check",
                            type: "POST",
                            data: sec2data,
                            success: function (res) {
                                ajaxProsEnd();
                                csrf = res.csrf;
                                if (res.status === "failed") {
                                    res.errors.forEach(function (err) {
                                        if (err.param === "vehicle") {
                                            fieldset.find("p.text-danger.vehErr").html(err.msg);
                                        } else {
                                            fieldset.find("input[name=" + err.param + "]").parent().find("p.text-danger").html(err.msg);
                                        }
                                    });
                                } else {
                                    next();
                                }
                            }
                        });
                    } else if (findInd === 2) {
                        var grabForm = document.getElementById("msform");
                        var formData = new FormData(grabForm);
                        formData.append('_csrf', csrf);

                        var hasDocs = $("#docsChg").is(":checked");
                        var validForm = true;
                        if (!hasDocs) {
                            if (!filesCheck(filesDocs)) {
                                validForm = false;
                            }
                        }
                        if (validForm) {
                            ajaxProsStart();
                            $.ajax({
                                url: '/partner',
                                data: formData,
                                cache: false,
                                contentType: false,
                                processData: false,
                                type: 'POST',
                                success: function (res) {
                                    ajaxProsEnd();
                                    if (res.status === "ok") {
                                        next();
                                    } else {
                                        if(res.errors.length > 0){
                                            if(Array.isArray(res.errors)){
                                                for(var i=0; i < res.errors.length; i++){
                                                    lastFormErrDiv.append("<p class='alert alert-danger'>"+res.errors[i]+"</p>");
                                                }
                                            }else{
                                                lastFormErrDiv.append("<p class='alert alert-danger'>"+res.errors+"</p>");
                                            }
                                        }
                                        csrf = res.csrf;
                                    }
                                }
                            });
                        }
                    }
                }
            }

            function ajaxProsStart(){
                ajaxStatus = true;
                $(".loading_pros").css({display: 'inline-block'});
            }

            function ajaxProsEnd(){
                ajaxStatus = false;
                $(".loading_pros").css({display: 'none'});
            }

            function filesCheck (filesObj) {
                var filesValid = true;
                var filesKeys = Object.keys(filesObj);
                var filesLength = filesKeys.length;
                for (var i = 0; i < filesLength; i++) {
                    var parent = $("#" + filesKeys[i]).parent();
                    var grabTitle = parent.find("label").text();
                    if (filesObj[filesKeys[i]] === null) {
                        parent.find("p.text-danger").html(grabTitle + " is required!");
                        if (filesValid) {
                            filesValid = false;
                        }
                    }else{
                        parent.find("p.text-danger").html("");
                    }
                }
                return filesValid;
            }
        script.
            /**
             * Created by 4slashmac on 1/16/17.
             */
                //jQuery time
            var current_fs, next_fs, previous_fs; //fieldsets
            var left, opacity, scale; //fieldset properties which we will animate
            var animating; //flag to prevent quick multi-click glitches
            $(".next").on("click", function () {
                current_fs = $(this).parent();
                next_fs = $(this).parent().next();
                submitForm(current_fs);
            });

            function next(){
                if(ajaxStatus) return false;
                if (animating) return false;
                animating = true;

                //activate next step on progressbar using the index of next_fs
                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                //show the next fieldset
                next_fs.show();
                //hide the current fieldset with style
                current_fs.animate({opacity: 0}, {
                    step: function (now, mx) {
                        //as the opacity of current_fs reduces to 0 - stored in "now"
                        //1. scale current_fs down to 80%
                        scale = 1 - (1 - now) * 0.2;
                        //2. bring next_fs from the right(50%)
                        left = (now * 50) + "%";
                        //3. increase opacity of next_fs to 1 as it moves in
                        opacity = 1 - now;
                        current_fs.css({
                            'transform': 'scale(' + scale + ')',
                            'position': 'absolute'
                        });
                        next_fs.css({'left': left, 'opacity': opacity});
                    },
                    duration: 800,
                    complete: function () {
                        current_fs.hide();
                        animating = false;
                    },
                    //this comes from the custom easing plugin
                    easing: 'easeInOutBack'
                });
            }

            $(".previous").click(function () {
                if(ajaxStatus) return false;
                if (animating) return false;
                animating = true;
                current_fs = $(this).parent();
                previous_fs = $(this).parent().prev();
                //de-activate current step on progressbar
                $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                //show the previous fieldset
                previous_fs.show();
                //hide the current fieldset with style
                current_fs.animate({opacity: 0}, {
                    step: function (now, mx) {
                        //as the opacity of current_fs reduces to 0 - stored in "now"
                        //1. scale previous_fs from 80% to 100%
                        scale = 0.8 + (1 - now) * 0.2;
                        //2. take current_fs to the right(50%) - from 0%
                        left = ((1 - now) * 50) + "%";
                        //3. increase opacity of previous_fs to 1 as it moves in
                        opacity = 1 - now;
                        current_fs.css({'left': left});
                        previous_fs.css({'transform': 'scale(' + scale + ')', 'opacity': opacity});
                    },
                    duration: 800,
                    complete: function () {
                        previous_fs.css({'position': 'relative'});
                        current_fs.hide();
                        animating = false;
                    },
                    //this comes from the custom easing plugin
                    easing: 'easeInOutBack'
                });
            });